# mmCalculator – Mechanical & Manufacturing Calculator

© 2021–2026 mmKreuzef (aka Daiki.NIIMI) Project mme
Licensed under the BSD 3-Clause License

[English](README.md) | [日本語](README.ja.md)

# 概要

本プロジェクトは，**数値計算・複素数演算・高精度数学関数**を備えた数式評価エンジンです。

電卓用途だけでなく，CAD・数式処理・現場や設計レベルでの関数電卓を想定しています。

Mathematicaに着想を得ているため，風味がしますが変数代入やシンボリック処理は意図的に実装していません。

---

## 細かいことは置いといて実例超特急

```txt
In [1] := (2+3)(4+5) + 2Pi
Out[1] := 51.28318530718

In [2] := hypot(3,4) + norm(3,4) + distance(0,0,3,4)
Out[2] := 15

In [3] := round(ln(E^5) + log10(1000) + log2(8), 10)
Out[3] := 11

In [4] := fma(10^16, 3, -10^16*3) + expm1(1) - (E-1)
Out[4] := 0

In [5] := sin(30)^2 + cos(30)^2
Out[5] := 1

In [6] := tan(45) + cot(Pi/4 rad) + sec(60deg) + csc(Pi/6 rad)
Out[6] := 6

In [7] := asin(0.5) + acos(0.5) + atan(1)
Out[7] := 135

In [8] := atan2(1,1) + atan2(1,-1) + atan2(-1,-1) + atan2(-1,1)
Out[8] := 360

In [9] :=Out[3]*Out[2]-Out[7]
Out[9] := 30

In [10] := %% / %
Out[10] := 12

In [11] := 3!^2/%
Out[11] := 1

In [12] := (-8)^(1/3)
Out[12] := 1+1.732050807569I

In [13] := exp(I Pi) + 1
Out[13] := 0

In [14] := polar(2,60) + cis(60)
Out[14] := 1.5+2.598076211353I

In [15] := abs(%) + arg(%) + re(%) + im(%)
Out[15] := 67.098076211353

In [16] := conj(%%) + unit(%%) - proj(%%)
Out[16] := 0.5-4.330127018922I

In [17] := mean(3,5,7,11,13,17) + median(1,3,5) + mode(1,2,2,3)
Out[17] := 14.3333333333333

In [18] := stddevs(3,5,7,11,13,17) + vars(1,2,3) + iqr(1,2,3,4)
Out[18] := 7.778888771954

In [19] := gcd(84,120) + lcm(6,8) + perm(10,3) + comb(10,3)
Out[19] := 876

In [20] := isprime(67280421310721) + fib(25)/75025 + %%%%%%%%%
Out[20] := 3
```

### 要点超特急

- 暗黙乗算あるよ(自然入力)
- `%`や`Out[n]`で過去履歴を計算に使えるよ
- 複素に対応
- 角度は度数法が既定だけど`rad`などで指定できよ
- 関数・定数がいっぱい！
- どんな場所でもつかえるよ！

# 詳細な内部事情

### 数値型

- **実数** IEEE754 double 1.7E±308(ただし表示は12桁)
- **複素数** `a + bI`

---

### 定数

すべて大文字で始まる

| 名前  | 説明                | 展開値                                  |
| ----- | ------------------- | --------------------------------------- |
| `Pi`  | 円周率              | `3.14159265358979323846264338327950288` |
| `Tau` | 2Pi (τ)             | `6.283185307179586476925286766559006`   |
| `E`   | 自然対数の底        | `2.7182818284590452353602874713526625`  |
| `Phi` | 黄金比              | `1.618033988749894848204586834365638`   |
| `NA`  | アボガドロ定数      | `6.02214076e23`                         |
| `I`   | 虚数単位            | `0+I`                                   |
| `ESP` | 内部収束誤差(1e-12) | `1e-12`                                 |

---

### 演算子

#### 四則・冪・階乗

| 演算子 | 説明               | 結合規則   |
| ------ | ------------------ | ---------- |
| `+ -`  | 加減算             | 左結合     |
| `* /`  | 乗除算             | 左結合     |
| `^`    | 冪乗               | **右結合** |
| `!`    | 階乗(非負整数のみ) | 後置       |

```text
2^3^2 = 2^(3^2)
-2^2 = -(2^2)
```

---

### 単項演算

- 単項 `+` `-` は任意回数連続可能

```text
---5 = -5
```

---

### 暗黙の乗算

以下のパターンは **自動的に乗算** として解釈される：

```text
2Pi
2(Pi)
Pi(2)
(2+3)(4+5)
(1+2)3(4+5)6
2 4
```

ただし，以下のような入力には留意せよ

| 入力    | 電卓の思考1  | 結果                            | 予想された結果(または入力ミス) |
| ------- | ------------ | ------------------------------- | ------------------------------ |
| `1..1`  | `1. .<-???`  | `Error: multiple '.' in number` | `1. * .1 = 0.1`                |
| `1.2.1` | `1.2 .<-???` | `Error: multiple '.' in number` | `1.2 * .1 = 0.12`              |

**関数名と数値は暗黙結合しない**

```text
【NG】
sin30 (Error)
sin2(30) (Error)

【OK】
sin(30)
cos(15+30)
```

必ず関数は`()`または`[]`で括ってください

---

### 関数

以下は現在実装されている全関数の一覧である。
関数名・概要・代表的な入力と出力例を示す。

---

### 基本数学(代数・指数・対数・丸め)

| 関数名           | 説明                 | 入力と出力例                     |
| ---------------- | -------------------- | -------------------------------- |
| `abs(x)`         | 絶対値(複素数対応)   | `abs(-3) = 3`<br>`abs(3+4I) = 5` |
| `sign(x)`        | 符号関数             | `sign(-5) = -1`<br>`sign(0) = 0` |
| `sqrt(x)`        | 平方根(負数は複素数) | `sqrt(4) = 2`<br>`sqrt(-4) = 2I` |
| `cbrt(x)`        | 立方根               | `cbrt(8) = 2`                    |
| `exp(x)`         | 指数関数             | `exp(1) = 2.71828...`            |
| `expm1(x)`       | `exp(x)-1`           | `expm1(1)=1.71828...`            |
| `log(x)`,`ln(x)` | 自然対数             | `log(E) = 1`                     |
| `log(b, x)`      | 任意底対数           | `log(10, 1000) = 3`              |
| `log10(x)`       | 常用対数             | `log10(100) = 2`                 |
| `log2(x)`        | 底2対数              | `log2(8) = 3`                    |
| `log1p(x)`       | `log(1+x)`           | `log1p(E-1)=1`                   |
| `floor(x)`       | 切り下げ             | `floor(3.7) = 3`                 |
| `ceil(x)`        | 切り上げ             | `ceil(3.1) = 4`                  |
| `trunc(x)`       | ゼロ方向丸め         | `trunc(-1.9)=-1`                 |
| `round(x)`       | 四捨五入             | `round(2.6) = 3`                 |
| `round(x,n)`     | n桁丸め              | `round(1.2345,2)=1.23`           |
| `fract(x)`       | 小数部分             | `fract(3.14)=0.14`               |
| `fact(x)`        | 階乗                 | `fact(10)=3628800`               |

---

### 特殊関数

| 関数名      | 説明          | 入力と出力例         |
| ----------- | ------------- | -------------------- |
| `gamma(x)`  | ガンマ関数    | `gamma(5)=24`        |
| `lgamma(x)` | logガンマ関数 | `lgamma(5)=3.178...` |
| `erf(x)`    | 誤差関数      | `erf(1)=0.842...`    |
| `erfc(x)`   | 相補誤差関数  | `erfc(1)=0.157...`   |

---

#### 角度変換

| 関数名    | 説明             | 入力と出力例    |
| --------- | ---------------- | --------------- |
| `DtoR(x)` | Degree -> Radian | `DtoR(180)=Pi`  |
| `DtoG(x)` | Degree -> Grad   | `DtoG(90)=100`  |
| `RtoD(x)` | Radian -> Degree | `RtoD(Pi)=180`  |
| `RtoG(x)` | Radian -> Grad   | `RtoG(Pi)=200`  |
| `GtoD(x)` | Grad -> Degree   | `GtoD(200)=180` |
| `GtoR(x)` | Grad -> Radian   | `GtoR(200)=Pi`  |

---

### 三角関数(角度制 / degree)

| 関数名       | 説明           | 入力と出力例    |
| ------------ | -------------- | --------------- |
| `sin(x)`     | 正弦           | `sin(30)=0.5`   |
| `cos(x)`     | 余弦           | `cos(60)=0.5`   |
| `tan(x)`     | 正接           | `tan(45)=1`     |
| `cot(x)`     | 余接           | `cot(45)=1`     |
| `sec(x)`     | 正割           | `sec(60)=2`     |
| `csc(x)`     | 余割           | `csc(30)=2`     |
| `asin(x)`    | 逆正弦         | `asin(0.5)=30`  |
| `acos(x)`    | 逆余弦         | `acos(0.5)=60`  |
| `atan(x)`    | 逆正接         | `atan(1)=45`    |
| `atan2(y,x)` | 象限付き逆正接 | `atan2(1,1)=45` |

---

### 双曲線関数

| 関数名     | 説明         | 入力と出力例          |
| ---------- | ------------ | --------------------- |
| `sinh(x)`  | 双曲線正弦   | `sinh(1)=1.175...`    |
| `cosh(x)`  | 双曲線余弦   | `cosh(0)=1`           |
| `tanh(x)`  | 双曲線正接   | `tanh(0)=0`           |
| `asinh(x)` | 逆双曲線正弦 | `asinh(1)=0.881...`   |
| `acosh(x)` | 逆双曲線余弦 | `acosh(1)=0`          |
| `atanh(x)` | 逆双曲線正接 | `atanh(0.5)=0.549...` |

---

### 特殊比関数(c 系 / degree)

| 関数名     | 説明           | 入力と出力例           |
| ---------- | -------------- | ---------------------- |
| `sinc(x)`  | `sin(x)/x`     | `sinc(90)=0.111...`    |
| `cosc(x)`  | `(1-cos(x))/x` | `cosc(60)=0.008333...` |
| `tanc(x)`  | `tan(x)/x`     | `tanc(0)=1`            |
| `sinhc(x)` | `sinh(x)/x`    | `sinhc(3)=3.339...`    |
| `tanhc(x)` | `tanh(x)/x`    | `tanhc(30)=0.03333...` |
| `expc(x)`  | `(exp(x)-1)/x` | `expc(1)=1.7182818...` |

- sin/cos/tanがdegree前提なので，これらもdegree入力です
- `x`が非常に小さいときは桁落ち対策が入ります

| 関数名     | 説明           | 入力と出力例       |
| ---------- | -------------- | ------------------ |
| `sincR(x)` | `sin(x)/x`     | `sincR(1e-8)≈1`    |
| `coscR(x)` | `(1-cos(x))/x` | `coscR(1e-8)≈5e-9` |
| `tancR(x)` | `tan(x)/x`     | `tancR(1e-8)≈1`    |

- R系は`x`をラジアンとして解釈をする(信号処理系の「sinc」が欲しいとき)

---

### 数論・組合せ

| 関数名       | 説明                              | 入力と出力例                |
| ------------ | --------------------------------- | --------------------------- |
| `gcd(a,b)`   | 最大公約数                        | `gcd(12,18)=6`              |
| `lcm(a,b)`   | 最小公倍数                        | `lcm(6,8)=24`               |
| `perm(n,r)`  | 順列 (r<0\|\|r>nのとき0)          | `perm(5,2)=20`              |
| `comb(n,r)`  | 組合せ (r<0\|\|r>nのとき0)        | `comb(5,2)=10`              |
| `isprime(x)` | 素数判定<br>(0: 合成数 / 1: 素数) | `isprime(67280421310721)=1` |
| `fib(x)`     | フィボナッチ数列                  | `fib(25)=75025`             |

---

### 統計(記述統計・集約)

| 関数名                 | 説明                                    | 入力と出力例                                                                                                                                                                         |
| ---------------------- | --------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `sum(...)`             | 合計                                    | `sum(1,2,3)=6`                                                                                                                                                                       |
| `mean(...)`,`ave(...)` | 平均                                    | `mean(1,2,3)=2`                                                                                                                                                                      |
| `min(...)`             | 最小値                                  | `min(3,1,2)=1`                                                                                                                                                                       |
| `max(...)`             | 最大値                                  | `max(3,1,2)=3`                                                                                                                                                                       |
| `prod(...)`            | 積(総積)                                | `prod(2,3,4)=24`                                                                                                                                                                     |
| `median(...)`          | 中央値                                  | `median(1,3,5)=3`                                                                                                                                                                    |
| `mode(...)`            | 最頻値                                  | `mode(1,2,2,3)=2`                                                                                                                                                                    |
| `percentile(p,...)`    | パーセンタイル                          | `percentile(50,1,3,5)=3`                                                                                                                                                             |
| `quantile(p,...)`      | 分位点(pは0～1)                         | `quantile(1/4,1,2,3,4,5,6,7)=2.5`                                                                                                                                                    |
| `var(x...)`            | 母分散(n で割る)                        | `var(1,2,3)=0.666666666667`                                                                                                                                                          |
| `vars(x...)`           | 不偏分散(n-1 で割る)                    | `vars(1,2,3)=1`                                                                                                                                                                      |
| `stddev(x...)`         | 標準偏差                                | `stddev(1,2,3)=0.816496580928`                                                                                                                                                       |
| `stddevs(x...)`        | 不偏標準偏差                            | `stddevs(1,2,3)=1`                                                                                                                                                                   |
| `geomean(...)`         | 幾何平均                                | `geomean(1,4,1/32)=0.5`                                                                                                                                                              |
| `harmmean(...)`        | 調和平均                                | `harmmean(1,2,6)=1.8`                                                                                                                                                                |
| `mad(...)`             | 中央絶対偏差(Median Absolute Deviation) | `mad(1,1,2,2,4)=1`                                                                                                                                                                   |
| `skew(...)`            | 歪度(分布の非対称性の指標)              | `skew(1,2,3,4,5)=0`(対称)<br>`skew(0,0,0,0,10) > 0`(右に裾が長い)<br>`skew(-10,0,0,0,0) < 0`(左に裾が長い)<br>`skew(-2,-1,0,1,2)=0`                                                  |
| `kurtp(...)`           | 母集団の超過尖度(正規分布 -> 0)         | `kurtp(-1,-0.5,0,0.5,1) < 0 (-1.3)`(裾が軽い)<br>`kurtp(0,0,0,0,0,10) >> 0`(裾が重い)<br>`kurtp(-2,-1,0,1,2) < 0`(一様分布っぽい)<br>`kurtp(0,0,0,0,0,-2,2) > 0`(外れ値の影響が強い) |
| `kurts(...)`           | 標本の超過尖度, `n\geq 5`               | `kurts(-1,-0.5,0,0.5,1)=-7.09`                                                                                                                                                       |
| `cv(...)`              | 変動係数 = stddev/mean                  | `cv(10,10,10)=0`                                                                                                                                                                     |
| `stderr(...)`          | 標準誤差 = stddev/sqrt(n), `n\geq 2`    | `stderr(1,2,3)=0.471...`                                                                                                                                                             |
| `zscore(x, mu, sigma)` | (x-mu)/sigma                            | `zscore(5,3,1)=2`                                                                                                                                                                    |
| `iqr(...)`             | Q3-Q1                                   | `iqr(1,2,3,4)=2`                                                                                                                                                                     |
| `trimmean(p,...)`      | pの割合を両側から捨てて平均             | `trimmean(0.2,1,2,100,3,4)=2.5`                                                                                                                                                      |
| `winsor(p,...)`        | pの割合を両側から丸める(winsorize)      | `winsor(0.2,1,2,100,3,4)=?`                                                                                                                                                          |

---

### 相関・共分散

| 関数名                    | 説明                     | 入力と出力例                      |
| ------------------------- | ------------------------ | --------------------------------- |
| `cov(x...,y...)`          | 共分散                   | `cov(1,2,3,2,4,6)=0.666...`       |
| `corr(x...,y...)`         | 相関係数                 | `corr(1,2,3,2,4,6)=1`             |
| `corrspearman(x...,y...)` | スピアマン相関(順位相関) | `corrspearman(1,2,3, 10,20,30)=1` |

---

### 数値計算(浮動小数点ユーティリティ)

| 関数名       | 説明                   | 入力と出力例       |
| ------------ | ---------------------- | ------------------ |
| `hypot(x,y)` | √(x²+y²)(桁落ちに強い) | `hypot(3,4)=5`     |
| `fma(a,b,c)` | a\*b+c を1回丸めで計算 | `fma(10,10,2)=102` |
| `rms(...)`   | 二乗平均平方根         | `rms(1,-1,1,-1)=1` |

---

### 複素

| 関数名                              | 説明                            | 例                     |
| ----------------------------------- | ------------------------------- | ---------------------- |
| `re(z)`, `real(z)`                  | 実部                            | `re(3+4I)=3`           |
| `im(z)`, `imag(z)`                  | 虚部                            | `im(3+4I)=4`           |
| `arg(z)`                            | 偏角(度)                        | `arg(1+I)=45`          |
| `conj(z)`                           | 複素共役                        | `conj(3+4I)=3-4I`      |
| `polar(r,theta)`<br>`rect(r,theta)` | 極形式 r∠θ(θは度)               | `polar(2,60)=1+1.732I` |
| `cis(x)`                            | cos(x) + i sin(x)(xは度)        | `cis(60)=0.5+0.866I`   |
| `mag(z)`                            | `abs(z)` の同義(大きさ `\|z\|`) | `mag(3+4I)=5`          |
| `proj(z)`                           | リーマン球面への射影            | `proj(3+4I)=3+4I`      |
| `unit(z)`, `csgn(z)`                | 単位複素数 `z/abs(z)`(複素sign) | `unit(3+4I)=0.6+0.8I`  |

---

#### 幾何・ベクトル(2D)

| 関数名                  | 説明        | 入力と出力例          |
| ----------------------- | ----------- | --------------------- |
| `norm(x,y)`             | ベクトル長  | `norm(3,4)=5`         |
| `dot(x1,y1,x2,y2)`      | 内積        | `dot(1,0,0,1)=0`      |
| `cross(x1,y1,x2,y2)`    | 外積(Z成分) | `cross(1,0,0,1)=1`    |
| `lerp(a,b,t) `          | 線形補間    | `lerp(0,10,0.5)=5`    |
| `distance(x1,y1,x2,y2)` | 距離        | `distance(0,0,3,4)=5` |

---

### 乱数

| 関数名             | 説明                                   | 入力と出力例                       |
| ------------------ | -------------------------------------- | ---------------------------------- |
| `rand()`           | 乱数 \[ 0,1)                           | `rand()=0.37...`                   |
| `rand(hi)`         | 乱数 \[ 0,5)                           | `rand(5)=3.37...` ただし0のとき0   |
| `rand(lo,hi)`      | 乱数 \[ lo,hi)                         | `rand(-2,2)=-0.71...`              |
| `randint()`        | 乱数 0 ro 1                            | `randint()=0`                      |
| `randint(a)`       | 乱数 \[ 0,a\] `a>0`<br> \[ a,0\] `a<0` | `randint(5)=2`                     |
| `randint(a,b)`     | 乱数 \[ a,b\]                          | `randint(1,6)=3` サイコロ          |
| `choice(a, b,...)` | 1つ抽出                                | `choice(2,3,5,7,9,11,13,17,19)=17` |
| `randn()`          | 正規乱数 N(0,1)                        | `randn()=-0.23...`                 |
| `randn(mu)`        | 正規乱数 N(mu,1)                       | `randn(10)=9.61...`                |
| `randn(mu,sigma)`  | 正規乱数 N(mu,sigma)                   | `randn(0,2)=1.74...`               |

---

### 材料力学(応力・ひずみ・弾性)

| 関数名             | 説明           | 例                        |
| ------------------ | -------------- | ------------------------- |
| `stress(F,A)`      | 応力 σ=F/A     | `stress(1000,10)=100`     |
| `strain(dL,L)`     | ひずみ ε=dL/L  | `strain(0.1,100)=0.001`   |
| `young(sigma,eps)` | ヤング率 E=σ/ε | `young(200,0.001)=200000` |

---

### 断面特性(I, Z, J)

| 関数名                 | 説明                | 例                             |
| ---------------------- | ------------------- | ------------------------------ |
| `moment_rect(b,h)`     | 矩形断面 I=b\*h³/12 | `moment_rect(10,20)=6666.6`    |
| `moment_circle(d)`     | 円断面 I=π\*d⁴/64   | `moment_circle(10)=490.87`     |
| `sectionmod_rect(b,h)` | 矩形断面 Z=b\*h²/6  | `sectionmod_rect(10,20)=666.6` |
| `sectionmod_circle(d)` | 円断面 Z=π\*d³/32   | `sectionmod_circle(10)=98.17`  |
| `torsion_J_circle(d)`  | 円断面 J=π\*d⁴/32   | `torsion_J_circle(10)=981.74`  |
| `polarZ_circle(d)`     | 円断面 Zp=π\*d³/16  | `polarZ_circle(10)=196.35`     |

---

### 締結・摩擦(ボルト・トルク)

| 関数名                       | 説明                   | 例                                       |
| ---------------------------- | ---------------------- | ---------------------------------------- |
| `bolt_stress(F,d)`           | ボルト応力 σ=F/(πd²/4) | `bolt_stress(10000,10)=127.3`            |
| `torque_from_preload(F,d,K)` | 締付けトルク T=KFd     | `torque_from_preload(10000,0.01,0.2)=20` |
| `preload_from_torque(T,d,K)` | 逆変換 F=T/(Kd)        | `preload_from_torque(20,0.01,0.2)=10000` |
| `friction(mu,N)`             | 摩擦力 F=μN            | `friction(0.2,100)=20`                   |

---

### ユーティリティ

| 関数名             | 説明  | 入力と出力例                  |
| ------------------ | ----- | ----------------------------- |
| `clamp(x, lo, hi)` | Clamp | `clamp(5,0,10)=5`             |
| `cnst("name")`     | 定数  | `cnst("celeritas")=299792458` |

定数一覧はこちら-> [【定数一覧】](constants_list.md)

---

### 履歴

| 関数名    | 説明              | 入力と出力例 |
| --------- | ----------------- | ------------ |
| `In[n]`   | n番目の入力再評価 | `In(1)`      |
| `Out[n]`  | n番目の出力       | `Out(1)`     |
| `Prev[k]` | k手前の出力       | `Prev(1)`    |
| `%`       | 手前の出力        | `%`          |
| `%%..`    | %の個数手前の出力 | `%%%%`       |

`%` -> 直前の出力
`%%` -> 1つ前の出力
`%%%` -> 2つ前の出力

---

#### システム関数

| 関数名    | 説明                                               |
| --------- | -------------------------------------------------- |
| `Clear[]` | Clearは履歴を消去し，`In[n] / Out[n]`を`n=1`にする |
| `Exit[]`  | プログラム終了                                     |

---

## 演算子優先順位表

以下に，本エンジンにおける**演算子の優先順位(高->低)**を示す。

| 優先度 | 演算子 / 構文  | 種別     | 結合規則   | 例                  |
| ------ | -------------- | -------- | ---------- | ------------------- |
| 1      | `!`            | 階乗     | 後置       | `3! = 6`            |
| 2      | 単項 `+ -`     | 単項演算 | 右結合     | `--5 = 5`           |
| 3      | `^`            | 冪乗     | **右結合** | `2^3^2 = 512`       |
| 4      | 暗黙の乗算     | 乗算     | 左結合     | `2Pi`, `(2+3)(4+5)` |
| 5      | `* /`          | 乗除算   | 左結合     | `10/2*3 = 15`       |
| 6      | `+ -`          | 加減算   | 左結合     | `1-2-3 = -4`        |
| 7      | `< <= > >= ==` | 比較     | 左結合     | `2 < 3 = 1`         |

### 優先順位に関する補足

- `!` は **最優先の後置演算子**である
- 単項演算子は冪乗よりも優先されますが，冪乗は右結合である
- 暗黙の乗算は明示的な `* /` よりも高い優先度を持つ
- 比較演算子は常に最後に評価される

---

### 比較演算子

| 演算子      | 意味     |
| ----------- | -------- |
| `< <= > >=` | 大小比較 |
| `==`        | 等価比較 |

- 結果は **1 (true) / 0 (false)**

---

### 複素数仕様

- `sqrt(-1) = I`
- `exp(I)` は Euler 形式
- 実数と複素数は自動昇格
- `+0I, -0I`はともにゼロとして評価される。故に`arg(-1+0I)=180`であり，`arg(-1-0I)=180`をそれぞれ得られる

---

### エラー仕様

以下は明示的に **Error** として扱われる：

- 括弧不整合
- 引数数不正
- 定義域外または無限大(`log(-1)`, `tan(90)` など)
- 不正構文(`2**3`, `1+*2` など)

---

#### エラー一覧

| 分類         | 内容                       | 例                       | 表示されるエラー                        |
| ------------ | -------------------------- | ------------------------ | --------------------------------------- |
| 構文エラー   | トークンの並びが不正       | `2**3`, `1+*2`, `sin(,)` | `syntax error`                          |
| 括弧エラー   | 括弧の不整合               | `(1+2`, `1+2)`           | `syntax error`                          |
| 引数数エラー | 関数の引数数が不正         | `sin()`, `log(1,2,3)`    | `function argument missing`             |
| 型エラー     | 許可されない演算引数を指定 | `(-3)!`, `deg2rad(1+I)`  | `factorial: negative value`等           |
| 定義域エラー | 数学的に未定義または無限大 | `log(-1)`, `tan(90)`     | `domain error`, `result is infinite` 等 |
| ゼロ除算     | 分母が 0                   | `1/0`, `10/(5-5)`        | `division by zero`                      |
| 未定義動作   | サポート外の構文           | `sin30`, `PiPi`, `2**`   | `unknown identifier`等                  |

#### エラー動作の方針

- エラー発生時，それ以降の評価は行われない
- エラーは値として伝播せず，直ちに表示される

---

## 使用方法

```text
In [1] := sin(30)^2 + cos(30)^2
Out[1] := 1

In [2] := sqrt(-4)
Out[2] := 2I

In [3] :=

In [3] := (2+3)(4+5)
Out[3] := 45

In [4] := 10/2+3
Out[4] := 8

In [5] := --3!-(-(3!))
Out[5] := 12

In [6] := gcd(8,4)
Out[6] := 4

In [7] := pow(4,0.5)
Out[7] := 2

In [8] := sin(90)
Out[8] := 1

In [9] := Out[3]+2
Out[9] := 47

In [10] := In[2+3]*5
Out[10] := 60


In [11] := %%
Out[11] := 47

In [12] := Clear[]

In [1] :=

```

---

#### 注意点・設計思想

## 角度制について

- 三角関数はすべて **degree** である。
  計算機科学等ではradなどが都合が良いですが，一般性を重視しDegreeを既定としている。

以下のように明示した場合はradianを指定できる。

```text
sin(Pi/2 rad) = 1
```

---

## 数値精度

- 内部は `double` ベース
- 1.7E±308の範囲しか扱えません。±1.7E+308を超えた場合はオーバーフローまたは無限大のエラーを出力する。

- IEEE754 に起因する誤差あり

```text
atan(0.57735026919) = 30.000000000016
5.9722e24 =  5972200000000000224395264
```

ただし，表示は小数12桁に丸め込まれ，履歴保持時は15桁で保存され演算に用いられるため，上記のように目立つ例は僅かだ。

```text
0.1 + 0.2 - 0.3
純粋なdouble: 0.00000000000000006
12桁区切り : 0
```

### 未実装／意図的制限

- 変数代入なし
- ユーザー定義関数なし
- シンボリック演算なし

---

### 既知の挙動

- `0^-1` -> `±inf`(IEEE754 準拠)
- `-0` が表示される場合あり
- `In[], Out[]`の`[]`内に数式を入れた場合は未定義

---

### 仕様の挙動

- 空白は原則無視されますが，数値間では暗黙乗算として処理される。`3 2` -> `3*2`
- 原則複素解がある場合は複素で返すが，`cbrt`は実数解を返す。(`(-8)^(1/3)=1+1.732050807569I`, `cbrt(-8)=-2`)

---

### 将来のお話

- [N]進数(0xや0b, add(),shift())の対応
- AngleModeの対応(setAngle=RADIAN)
- evalにおけるexpect化

---

## 文法定義(Extended Backus–Naur Form)

以下は本エンジンの構文を表す

```ebnf
(* トークン定義（抽象化） *)
digit       ::= "0" | "1" | "2" | "3" | "4" | "5" | "6" | "7" | "8" | "9" ;
letter      ::= "A" | ... | "Z" | "a" | ... | "z" ;
underscore  ::= "_" ;
identifier  ::= (letter | underscore) , { letter | digit | underscore } ;
number ::= integer | float ;
string      ::= '"' , { any_character_except_quote } , '"' ;
constant    ::= "Pi" | "E" | "Phi" | "I" ;
function_call ::= identifier "(" [ arguments ] ")" ;
arguments ::= expression { "," expression } ;
integer ::= digit { digit } ;
float ::= digit { digit } "." digit { digit } ;

plus        ::= "+" ;  minus       ::= "-" ;
mul         ::= "*" ;  div         ::= "/" ;
pow         ::= "^" ;
lparen      ::= "(" ;  rparen      ::= ")" ;
lbracket    ::= "[" ;  rbracket    ::= "]" ;
comma       ::= "," ;  bang        ::= "!" ;
lt          ::= "<" ;  le          ::= "<=" ;
gt          ::= ">" ;  ge          ::= ">=" ;
eq          ::= "==";  percent     ::= "%";

(* 基本式 *)
Expression      ::= Term , { ( plus | minus ) , Term } ;
Term            ::= Factor , { ( mul | div | ImplicitMul ) , Factor } ;
Factor          ::= Unary ;
Unary           ::= [ plus | minus ] , Power ;
Power           ::= Postfix , [ pow , Unary ] ;
Postfix         ::= Primary , { bang } ;

Primary         ::=
    | number
    | string
    | constant
    | function_call
    | percent { percent }       (* history reference *)
    | identifier [ FunctionCallOrUnit ]
    | "(" , Expression , ")"
    | "[" , Expression , "]" ;

FunctionCallOrUnit ::=
    | "(" , [ Expression , { comma , Expression } ] , ")"
    | "[" , [ Expression , { comma , Expression } ] , "]"
    | UnitIdentifier ;

UnitIdentifier  ::= identifier ; (* 30deg, 45rad など *)

(* 暗黙乗算の概念をEBNFで抽象化 ※ In[n], Out[n], %, %% 等は lexer レベルで special token として処理される *)
ImplicitMul     ::= /* 記号なしで値同士が並ぶ場合 */ ;


(* 比較式 *)
Compare         ::= Expression , { ( lt | le | gt | ge | eq ) , Expression } ;
```

### 実行時引数

実行時引数に数式を受け取った場合は解を出力し，終了します。
履歴機能は使えません。

### 文法上の補足

- `^` は **右結合**
- `!` は最優先の後置演算子
- 暗黙乗算はトークン隣接ルールにより解決される(EBNF外仕様)
- 関数名と数値の直接結合は構文エラー

---

## ライセンス

BSD 3-Clause

Copyright (c) 2021–2026 mmKreutzef

このソフトウェアを学術論文や商用製品で使用する場合，ドキュメントや出版物においてその旨を明記してください。

お知らせいただけると喜びます。

---

## テスト

本プロジェクトは **600の自動テスト**を含み，以下を網羅しています：

- 演算子優先順位と結合規則
- エラー処理
- 複素数演算
- 境界値・異常系

---

## 備考

本プロジェクトは、厳密な演算子意味論と実用的な数式評価の両立を目指しています。
また、設計者や製造現場において、どのような環境でも簡便に動作することを目的としています。

---

### **免責事項**

本ソフトウェアは，「現状のまま」提供され，商業的利用の適合性，特定目的への適合性，非侵害など，明示または黙示の保証は一切ありません。
著者または著作権者は，契約，不法行為，その他の理由で発生する，または発生したソフトウェアに関連するすべての請求，損害，またはその他の責任に対して，一切責任を負いません。

本ソフトウェアを使用することにより，ソフトウェアの使用に関して発生するすべてのリスクは自己責任であることを認め，自動的に同意したことになります。
著者は，データの損失，システムの不具合，その他ソフトウェアの使用によって生じた損害について一切責任を負いません。

---

### 謝辞

このツール開発のきっかけとなった過去の自分と，学びの園であった大学と教授殿，実使用環境として現職場に感謝の意を表します

---

# 要望等

githubに投げてください。加工現場や設計現場で必要なも，実装の提案等あれば大歓迎です🍀
