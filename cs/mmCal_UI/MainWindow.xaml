<Window x:Class="MmCalculatorWpf.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="mmCalculator-UI"
        Height="400" Width="600"
        Background="#1E1E1E" Foreground="White">

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Toolbar -->
            <RowDefinition Height="*"/>
            <!-- History -->
            <RowDefinition Height="72"/>
            <!-- Recent -->
            <RowDefinition Height="54"/>
            <!-- Input -->
        </Grid.RowDefinitions>

        <!-- Toolbar -->
        <Border Grid.Row="0"
        Background="#2D2D30"
        CornerRadius="6"
        Padding="8">

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- 左：ボタン -->
                <StackPanel Orientation="Horizontal" Grid.Column="0">
                    <Button Content="Clear" Click="ClearButton_Click" Padding="10,2" Margin="0,0,6,0"/>
                    <Separator/>

                    <Button Content="Copy In" Click="CopyInButton_Click" Padding="10,2" Margin="6,0,0,0"/>
                    <Button Content="Copy Out" Click="CopyOutButton_Click" Padding="10,2" Margin="6,0,0,0"/>
                    <Button Content="Copy Both" Click="CopyBothButton_Click" Padding="10,2" Margin="6,0,0,0"/>
                </StackPanel>

                <!-- 中央：通知 -->
                <TextBlock x:Name="CopyToastTextBlock"
                   Grid.Column="1"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"
                   Foreground="LightGreen"
                   Visibility="Collapsed"
                   Text="Copied!" />

                <!-- 右：テーマ色 -->
                <Border Grid.Column="2"
                Width="18" Height="18"
                Background="#007ACC"
                CornerRadius="3"
                BorderBrush="#888"
                BorderThickness="1"
                VerticalAlignment="Center"/>
            </Grid>
        </Border>


        <!-- History -->
        <DataGrid x:Name="HistoryGrid"
                  Grid.Row="1"
                  AutoGenerateColumns="False"
                  IsReadOnly="True"
                  HeadersVisibility="Column"
                  GridLinesVisibility="None"
                  Background="#1E1E1E"
                  Foreground="White"
                  BorderBrush="#3C3C3C"
                  RowBackground="#1E1E1E"
                  AlternatingRowBackground="#252526"
                  FontFamily="Consolas"
                  FontSize="14"
                  SelectionMode="Single"
                  SelectionUnit="Cell"
                  MouseDoubleClick="HistoryGrid_MouseDoubleClick">

            <DataGrid.Resources>

                <!-- Column header -->
                <Style TargetType="DataGridColumnHeader">
                    <Setter Property="Background" Value="#2D2D30"/>
                    <Setter Property="Foreground" Value="White"/>
                    <Setter Property="BorderBrush" Value="#3C3C3C"/>
                    <Setter Property="Padding" Value="8,4"/>
                    <Setter Property="FontWeight" Value="SemiBold"/>
                </Style>

                <!-- Cell -->
                <Style TargetType="DataGridCell">
                    <Setter Property="Background" Value="Transparent"/>
                    <Setter Property="Foreground" Value="White"/>
                    <Setter Property="BorderBrush" Value="Transparent"/>
                    <Setter Property="Padding" Value="8,2"/>
                    <Setter Property="FocusVisualStyle" Value="{x:Null}"/>

                    <Style.Triggers>
                        <Trigger Property="IsSelected" Value="True">
                            <!-- ここを青じゃなく暗い色に -->
                            <Setter Property="Background" Value="#3A3D41"/>
                            <Setter Property="Foreground" Value="White"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>

            </DataGrid.Resources>

            <DataGrid.Columns>

                <!-- Index -->
                <DataGridTextColumn Header="#"
                        Binding="{Binding Index}"
                        Width="60" />

                <!-- In -->
                <DataGridTemplateColumn Header="In" Width="*">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBox Text="{Binding Input}"
                         IsReadOnly="True"
                         BorderThickness="0"
                         Background="Transparent"
                         Foreground="White"
                         FontFamily="Consolas"
                         FontSize="14"
                         Padding="0"
                         IsHitTestVisible="True"
                         Focusable="True"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- Out -->
                <DataGridTemplateColumn Header="Out" Width="*">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBox Text="{Binding Output}"
                         IsReadOnly="True"
                         BorderThickness="0"
                         Background="Transparent"
                         Foreground="White"
                         FontFamily="Consolas"
                         FontSize="14"
                         Padding="0"
                         IsHitTestVisible="True"
                         Focusable="True"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

            </DataGrid.Columns>

        </DataGrid>

        <!-- Recent -->
        <Grid Grid.Row="2">
            <!-- Recent output -->
            <TextBox x:Name="RecentOutputTextBox"
             FontFamily="Consolas"
             FontSize="14"
             Background="#2D2D30"
             Foreground="White"
             IsReadOnly="True"
             TextWrapping="Wrap"
             Padding="8"
             VerticalScrollBarVisibility="Auto"
             HorizontalScrollBarVisibility="Disabled"/>

            <!-- Copy button overlay -->
            <Button x:Name="CopyRecentButton"
            Content="Copy"
            Width="64"
            Height="26"
            HorizontalAlignment="Right"
            VerticalAlignment="Bottom"
            Margin="0,0,10,10"
            Background="#66000000"
            Foreground="White"
            BorderBrush="#44FFFFFF"
            Cursor="Hand"
            Click="CopyRecentButton_Click"/>
        </Grid>


        <!-- Input -->
        <DockPanel Grid.Row="3" LastChildFill="True">
            <Button 
                    Width="100"
                    Margin="5"
                    Click="EvaluateButton_Click">
                <StackPanel>
                    <TextBlock Text="Evaluate" TextAlignment="Center"/>
                    <TextBlock Text="or Shift+Enter" FontSize="10" TextAlignment="Center"/>
                </StackPanel>
            </Button>

            <Grid>
                <TextBox x:Name="InputTextBox"
                         FontFamily="Consolas"
                         FontSize="14"
                         VerticalAlignment="Center"
                         VerticalContentAlignment="Center"
                         Background="#252526"
                         Foreground="White"
                         AcceptsReturn="False"
                         TextWrapping="Wrap"
                         KeyDown="InputTextBox_KeyDown"
                         KeyUp="InputTextBox_KeyDown"
                         TextChanged="InputTextBox_TextChanged"
                         GotFocus="InputTextBox_GotFocus"
                         LostFocus="InputTextBox_LostFocus"
                         Height="50"/>

                <TextBlock x:Name="PlaceholderTextBlock"
                           FontFamily="Consolas"
                           Text="Enter expression..."
                           FontSize="14"
                           Foreground="Gray"
                           Margin="4,17,0,0"
                           IsHitTestVisible="False"
                           VerticalAlignment="Top"/>
            </Grid>
        </DockPanel>

    </Grid>
</Window>
